©
2/home/alumno/secure-code/99-labs/server/Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder		 
.		 
Services		 
.		 #
AddControllersWithViews		 (
(		( )
)		) *
;		* +
builder 
. 
Services 
. 
AddDbContext 
< 
TestContext )
>) *
(* +
options+ 2
=>3 5
options 
. 
	UseNpgsql 
( 
$str W
)W X
)X Y
;Y Z
var 
app 
= 	
builder
 
. 
Build 
( 
) 
; 
if 
( 
! 
app 
. 	
Environment	 
. 
IsDevelopment "
(" #
)# $
)$ %
{ 
app 
. 
UseExceptionHandler 
( 
$str )
)) *
;* +
app 
. 
UseHsts 
( 
) 
; 
} 
app 
. 
UseStaticFiles 
( 
) 
; 
app 
. 

UseRouting 
( 
) 
; 
app!! 
.!! 
UseAuthorization!! 
(!! 
)!! 
;!! 
app## 
.## 
MapControllerRoute## 
(## 
name$$ 
:$$ 	
$str$$
 
,$$ 
pattern%% 
:%% 
$str%% 5
)%%5 6
;%%6 7
app'' 
.'' 
Run'' 
('' 
$str'' 
)'' 
;'' Ž
6/home/alumno/secure-code/99-labs/server/Models/User.cs
	namespace 	
server
 
. 
Models 
; 
public 
partial 
class 
User 
{ 
public 

int 
Id 
{ 
get 
; 
set 
; 
} 
public

 

string

 
Username

 
{

 
get

  
;

  !
set

" %
;

% &
}

' (
=

) *
null

+ /
!

/ 0
;

0 1
public 

string 
Password 
{ 
get  
;  !
set" %
;% &
}' (
=) *
null+ /
!/ 0
;0 1
public 

string 
MoreInfo 
{ 
get 
;  
set  #
;# $
}$ %
=& '
null( ,
;, -
} ð
=/home/alumno/secure-code/99-labs/server/Models/TestContext.cs
	namespace 	
server
 
. 
Models 
; 
public 
partial 
class 
TestContext  
:! "
	DbContext# ,
{ 
public		 

TestContext		 
(		 
)		 
{

 
} 
public 

TestContext 
( 
DbContextOptions '
<' (
TestContext( 3
>3 4
options5 <
)< =
: 	
base
 
( 
options 
) 
{ 
} 
public 

virtual 
DbSet 
< 
User 
> 
Users $
{% &
get' *
;* +
set, /
;/ 0
}1 2
	protected 
override 
void 
OnConfiguring )
() *#
DbContextOptionsBuilder* A
optionsBuilderB P
)P Q
=> 

optionsBuilder 
. 
	UseNpgsql #
(# $
$str$ e
)e f
;f g
	protected 
override 
void 
OnModelCreating +
(+ ,
ModelBuilder, 8
modelBuilder9 E
)E F
{ 
modelBuilder 
. 
Entity 
< 
User  
>  !
(! "
entity" (
=>) +
{ 	
entity 
. 
HasKey 
( 
e 
=> 
e  
.  !
Id! #
)# $
.$ %
HasName% ,
(, -
$str- 9
)9 :
;: ;
entity 
. 
ToTable 
( 
$str "
)" #
;# $
entity 
. 
Property 
( 
e 
=>  
e! "
." #
Id# %
)% &
.& '
HasColumnName' 4
(4 5
$str5 9
)9 :
;: ;
entity   
.   
Property   
(   
e   
=>    
e  ! "
.  " #
Password  # +
)  + ,
.!! 
HasMaxLength!! 
(!! 
$num!!  
)!!  !
."" 
HasColumnName"" 
("" 
$str"" )
)"") *
;""* +
entity## 
.## 
Property## 
(## 
e## 
=>##  
e##! "
.##" #
Username### +
)##+ ,
.$$ 
HasMaxLength$$ 
($$ 
$num$$  
)$$  !
.%% 
HasColumnName%% 
(%% 
$str%% )
)%%) *
;%%* +
entity&& 
.&& 
Property&& 
(&& 
e&& 
=>&&  
e&&! "
.&&" #
MoreInfo&&# +
)&&+ ,
.'' 
HasMaxLength'' 
('' 
$num'' "
)''" #
.(( 
HasColumnName(( 
((( 
$str(( )
)(() *
;((* +
})) 	
)))	 

;))
 "
OnModelCreatingPartial++ 
(++ 
modelBuilder++ +
)+++ ,
;++, -
},, 
partial.. 
void.. "
OnModelCreatingPartial.. '
(..' (
ModelBuilder..( 4
modelBuilder..5 A
)..A B
;..B C
}// †
@/home/alumno/secure-code/99-labs/server/Models/ErrorViewModel.cs
	namespace 	
server
 
. 
Models 
; 
public 
class 
ErrorViewModel 
{ 
public 

string 
? 
	RequestId 
{ 
get "
;" #
set$ '
;' (
}) *
public 

bool 
ShowRequestId 
=>  
!! "
string" (
.( )
IsNullOrEmpty) 6
(6 7
	RequestId7 @
)@ A
;A B
} Í
E/home/alumno/secure-code/99-labs/server/Controllers/UserController.cs
	namespace 	
server
 
. 
Controllers 
; 
public 
class 
UserController 
: 

Controller (
{ 
private		 
readonly		 
ILogger		 
<		 
UserController		 +
>		+ ,
_logger		- 4
;		4 5
private

 
readonly

 
TestContext

  
_context

! )
;

) *
public 

UserController 
( 
ILogger !
<! "
UserController" 0
>0 1
logger2 8
,8 9
TestContext: E
contextF M
)M N
{ 
_logger 
= 
logger 
; 
_context 
= 
context 
; 
} 
public 

IActionResult 
Index 
( 
)  
{ 
return 
View 
( 
) 
; 
} 
[ 
HttpGet 
] 
public 

IActionResult 
Create 
(  !
)! "
{ 
return 
View 
( 
) 
; 
} 
[ 
HttpPost 
] 
public 

IActionResult 
Create 
(  
string  &
username' /
,/ 0
string1 7
password8 @
,@ A
stringA G
moreInfoH P
)P Q
{ 
if   

(   
string   
.   
IsNullOrEmpty    
(    !
username  ! )
)  ) *
||  + -
string  . 4
.  4 5
IsNullOrEmpty  5 B
(  B C
password  C K
)  K L
)  L M
{!! 	

ModelState"" 
."" 
AddModelError"" $
(""$ %
string""% +
.""+ ,
Empty"", 1
,""1 2
$str""3 X
)""X Y
;""Y Z
return## 
View## 
(## 
$str## 
)##  
;##  !
}$$ 	
_context'' 
.'' 
Add'' 
('' 
new'' 
User'' 
{'' 
Username''  (
='') *
username''+ 3
,''3 4
Password''5 =
=''> ?
password''@ H
,''I J
MoreInfo''K S
=''T U
moreInfo''V ^
}''^ _
)''_ `
;''` a
_context(( 
.(( 
SaveChanges(( 
((( 
)(( 
;(( 
return** 
RedirectToAction** 
(**  
$str**  '
,**' (
$str**) /
)**/ 0
;**0 1
}++ 
[-- 
HttpGet-- 
(-- 
$str-- #
)--# $
]--$ %
public.. 

IActionResult.. 
Info.. 
(.. 
string.. $
username..% -
)..- .
{// 
var00 
user00 
=00 
_context00 
.00 
Users00 !
.00! "
FirstOrDefault00" 0
(000 1
u001 2
=>003 5
u006 7
.007 8
Username008 @
==00A C
username00D L
)00L M
;00M N
if11 

(11 
user11 
==11 
null11 
)11 
{22 	
return33 
NotFound33 
(33 
)33 
;33 
}44 	
return55 
View55 
(55 
user55 
)55 
;55 
}66 
}88 Ë
E/home/alumno/secure-code/99-labs/server/Controllers/HomeController.cs
	namespace 	
server
 
. 
Controllers 
; 
public 
class 
HomeController 
: 

Controller (
{ 
private		 
readonly		 
ILogger		 
<		 
HomeController		 +
>		+ ,
_logger		- 4
;		4 5
public 

HomeController 
( 
ILogger !
<! "
HomeController" 0
>0 1
logger2 8
)8 9
{ 
_logger 
= 
logger 
; 
} 
public 

IActionResult 
Index 
( 
)  
{ 
return 
View 
( 
) 
; 
} 
public 

IActionResult 
Privacy  
(  !
)! "
{ 
return 
View 
( 
) 
; 
} 
[ 
ResponseCache 
( 
Duration 
= 
$num 
,  
Location! )
=* +!
ResponseCacheLocation, A
.A B
NoneB F
,F G
NoStoreH O
=P Q
trueR V
)V W
]W X
public 

IActionResult 
Error 
( 
)  
{ 
return 
View 
( 
new 
ErrorViewModel &
{' (
	RequestId) 2
=3 4
Activity5 =
.= >
Current> E
?E F
.F G
IdG I
??J L
HttpContextM X
.X Y
TraceIdentifierY h
}i j
)j k
;k l
} 
}   